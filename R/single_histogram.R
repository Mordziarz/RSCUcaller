#' Visualize Relative Synonymous Codon Usage (RSCU) Distribution (1 genome)
#' 
#' Generates a comprehensive histogram displaying codon usage patterns,
#' integrating amino acid and codon annotations with color-coded grouping information.
#'
#' @param get_RSCU_out A data frame generated by \code{\link{get_RSCU}} containing
#'   RSCU values with columns: \code{index}, \code{RSCU}, \code{Col} (group indicator),
#'   \code{AA} (amino acid), and \code{codon}
#' @param title Main title for the visualization. Default is empty string
#'
#' @return A \code{patchwork} object combining three stacked plot panels:
#' \itemize{
#'   \item Top panel: Main RSCU histogram with codon labels positioned above bars
#'   \item Middle panel: Amino acid and codon tile annotation layer
#'   \item Bottom panel: Amino acid labels for reference
#' }
#' 
#' @details
#' This visualization provides a comprehensive view of codon usage patterns:
#' \itemize{
#'   \item Displays RSCU values as vertical bars with numeric labels
#'   \item Groups codons by amino acid with color differentiation
#'   \item Reverse-sorts sample display for consistent comparison
#'   \item Automatically scales plot proportions for visual clarity
#' }
#' 
#' The plot effectively illustrates:
#' \itemize{
#'   \item Codon preference within amino acid groups
#'   \item Relative synonymous codon usage bias across samples
#'   \item Sample-specific and group-level codon patterns
#' }
#'
#' @examples
#' # Using example RSCU data
#' data("prepared_fasta", package = "RSCUcaller")
#' rscu_data <- get_RSCU(prepared_fasta)
#' 
#' # Generate histogram
#' plot <- single_histogram(rscu_data, title = "Codon Usage Distribution")
#' plot
#'
#' @seealso
#' \code{\link{get_RSCU}} for generating input data,
#' \code{\link{heatmap_RSCU}} for alternative visualization approaches
#' 
#' @export
#' @importFrom ggplot2 ggplot aes geom_bar geom_tile geom_text theme_minimal theme_void
#'   ggtitle element_text element_blank
#' @importFrom patchwork plot_layout
#' @importFrom forcats fct_rev

single_histogram <- function(get_RSCU_out, title = "") {
  if (missing(get_RSCU_out)) {
    stop("The get_RSCU_out predictions are required. Please provide a valid argument.", call. = FALSE)
  }
  message("Generating plot... ")
  
  get_RSCU_out$Col2 <- factor(1)
  
  p0 <- ggplot2::ggplot(data = get_RSCU_out, aes(x = index, y = RSCU, fill = Col)) + 
    geom_bar(stat = "identity") +
    theme_minimal() +
    ggtitle(title) +
    theme(
      plot.title = element_text(hjust = 0.5),
      axis.text.x = element_blank(),
      axis.ticks.x = element_blank(),
      axis.title.x = element_blank(),
      panel.grid.major = element_blank(),
      panel.border = element_blank(),
      panel.background = element_blank(),
      legend.position = "none"
    )
  
  p1 <- ggplot2::ggplot(data = get_RSCU_out) + 
    geom_tile(aes(x = AA, y = fct_rev(Col), fill = Col), col = "white") +
    geom_text(aes(x = AA, y = Col, label = codon), col = "white") +
    theme_void() +
    theme(legend.position = "none")
  
  p2 <- ggplot2::ggplot(data = get_RSCU_out) + 
    geom_tile(aes(x = AA, y = fct_rev(Col2)), col = "white") +
    geom_text(aes(x = AA, y = Col2, label = AA), col = "white", fontface = "bold", angle = 0) +
    theme_void() +
    theme(legend.position = "none") +
    ggtitle("")
  
  p <- p0 / p1 / p2 + patchwork::plot_layout(nrow = 3, heights = c(2, 1, 0.2))
  
  message("Success")
  return(p)
}